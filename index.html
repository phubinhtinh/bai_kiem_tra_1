<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Kiểm Tra</title>
</head>
<body>
    <script>
//         class HocSinh{
//             constructor(maHs, hoTen, lopHoc, diemTB, hanhKiem) {
//                 this.maHS = maHs;
//                 this.hoTen = hoTen;
//                 this.lopHoc = lopHoc;
//                 this.diemTB = diemTB;
//                 this.hanhKiem = hanhKiem;
//             }
//         }
        
//        const duLieuBanDau = [
//             new HocSinh("ma2025001", "Nguyễn Văn An", "10A1", 9.2, "Tốt"),
//             new HocSinh("ma2025002", "Trần Thị Bình", "10A1", 7.8, "Khá"),
//             new HocSinh("ma2025003", "Lê Văn Cường", "11B2", 5.5, "Trung bình"),
//             new HocSinh("ma2025004", "Phạm Thu Hà", "10A1", 8.8, "Tốt"),
//             new HocSinh("ma2025005", "Vũ Minh Đức", "11B2", 4.1, "Yếu")
// ];

        const duLieuBanDau = [
    {
        maHS: "ma2025001", 
        hoTen: "Nguyễn Văn An", 
        lopHoc: "10A1", 
        diemTB: 9.2, 
        hanhKiem: "Tốt"
    },

    {
        maHS: "ma2025002", 
        hoTen: "Trần Thị Bình", 
        lopHoc: "10A1", 
        diemTB: 7.8, 
        hanhKiem: "Khá"
    },

    {
        maHS: "ma2025003", 
        hoTen: "Lê Văn Cường", 
        lopHoc: "11B2", 
        diemTB: 5.5, 
        hanhKiem: "Trung bình"
    },

    {
        maHS: "ma2025004", 
        hoTen: "Phạm Thu Hà", 
        lopHoc: "10A1", 
        diemTB: 8.8, 
        hanhKiem: "Tốt"
    },

    {
        maHS: "ma2025005", 
        hoTen: "Vũ Minh Đức", 
        lopHoc: "11B2", 
        diemTB: 4.1, 
        hanhKiem: "Yếu"
    }
];
        const layNamHienTai = () => new Date().getFullYear();
        const quanLyTruongHoc = {
            danhSach : [],
            soLuongHocSinhNumber: 0,

            khoiTao: function (data) {
                this.danhSach = data;
                this.soLuongHocSinhNumber += data.length;
                
            },

            themHocSinh: function(hocSinh){
                this.soLuongHocSinhNumber++; 
                const soThuTu = String(this.soLuongHocSinhNumber).padStart(3, '0')
                const maHsobj = {
                    maHS : "ma" + layNamHienTai() + soThuTu   
                }
                const newHocSinh = {...maHsobj,...hocSinh};
                this.danhSach.push(newHocSinh);
                return newHocSinh;
            },

            timHocSinh: function(maHsCanTim){
                const ketQua = this.danhSach.find(hs => hs.maHS === maHsCanTim);  
                if(ketQua){
                    return ketQua;
                }
                else{
                    return null;
                }
            },

            capNhatThongTin: function(maHsCanTim, duLieuMoi){

                const hocSinhCu = this.danhSach.findIndex(hocSinh => {
                    return hocSinh.maHS === maHsCanTim;
                })
                const duLieuCu = this.danhSach[hocSinhCu];
                if(hocSinhCu){
                    Object.assign(duLieuCu, duLieuMoi);
                    return true;
                }
                else{
                    return false;
                }
            },

            xoaHocSinh:  function(maHsCanTim){
                const viTri = this.danhSach.findIndex(hocSinh => {
                    return hocSinh.maHS === maHsCanTim;
                })

                if(viTri !== -1){
                    this.danhSach.splice(viTri, 1);
                    return true;
                }
                return false
            },

            layDanhSachTheoLop: function(tenLop){
                const mangLopMoi = this.danhSach.filter(hocSinh => {
     
                    return hocSinh.lopHoc === tenLop; 
                });
                return mangLopMoi;

            },

            thongKeHocLuc: function(){
                const thongKe = {};
                var demXs = 0;
                var demGioi = 0;
                var demKha = 0;
                var demTrungBinh = 0;
                var demKem= 0;
                
                for(let i of this.danhSach){
                    if(i.diemTB >= 9.0){
                        demXs++;
                        thongKe.XuatSac = demXs;
                    }
                    else if(i.diemTB >= 8.0){
                        demGioi++;
                        thongKe.Gioi = demGioi;
                    }
                    else if(i.diemTB >= 6.5){
                        demKha++;
                        thongKe.Kha = demKha;
                    }
                    else if(i.diemTB >= 5.0){
                        demTrungBinh++;
                        thongKe.TrungBinh = demKha;
                    }
                    else {
                        demKem++;
                        thongKe.Kem = demKha;
                    }
                }
                return thongKe;
            },

            sapXepTheoDiem: function(kieuSapXep){
                const danhSachSapXep = [...this.danhSach];

                if(kieuSapXep === "tang"){
                    danhSachSapXep.sort((a, b) => a.diemTB - b.diemTB);
                    
                } else if (kieuSapXep === "giam"){
                    danhSachSapXep.sort((a, b) => b.diemTB - a.diemTB);
                    
                } 
                return danhSachSapXep;
            }


        }
        //Khởi tạo
        quanLyTruongHoc.khoiTao(duLieuBanDau);

        // Thêm Học Sinh
        test_1 = {
            hoTen: "Phú",
            lopHoc: "12b2",
            diemTB: 4.1,
            hanhKiem: "Yếu"
        }
        console.log("---Thêm Học Sinh---");
        quanLyTruongHoc.themHocSinh(test_1);
        console.log(quanLyTruongHoc.danhSach);

        console.log("---Tìm Học Sinh---");
        console.log(quanLyTruongHoc.timHocSinh("ma20250010"));

        console.log("---Cập Nhật Thông Tin---");
        test_2 = {
            hoTen: "Hí",
            lopHoc: "11b1",
            diemTB: 10,
            hanhKiem: "Yếu"
        }
        if(quanLyTruongHoc.capNhatThongTin("ma2025005", test_2) === true){
            console.log("Cập Nhật Thành Công!");
        }
        else{
            console.log("Cập Nhật Thất Bại!");
        }
        console.log("---Xóa Học Sinh---");
        console.log(quanLyTruongHoc.xoaHocSinh("ma2025005"));

        console.log("---Lấy Danh Sách Theo Lớp---");
        console.log(quanLyTruongHoc.layDanhSachTheoLop("11B2"));

        console.log("---Thống Kê Học Lực---");
        console.log(quanLyTruongHoc.thongKeHocLuc());

        console.log("---Sắp Xếp Theo Điểm---");
        console.log(quanLyTruongHoc.sapXepTheoDiem("giam"));
    </script>
</body>
</html>